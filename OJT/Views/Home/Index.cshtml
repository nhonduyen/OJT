@{
    ViewBag.Title = "MAIN";
    var MENTOR = Request.QueryString["MENTOR"];
    var EMP_ID = Request.QueryString["EMP_ID"];
    var now = DateTime.Now.ToString();
    var download = Url.Content("~/Upload/Template/OJT management system.pptx");
}
@section Scripts
{
    <script src="@Url.Content("~/Scripts/home.js")"></script>
}
@Html.Hidden("hdUrl", Url.Action("Action", "Ajax"))
<input type="hidden" id="user" value="@Session["Username"]" data-role="@Session["Role"]" data-dept="@Session["Dept"]" />
<h4 class="page-header" style="margin: 10px;"><strong>Main</strong></h4>
<div class="row">
    <div class="col-sm-8">
        <form class="form-inline">
            <div class="form-group">
                <label for="from">Mentor:</label>
                <select class="form-control" id="mentor" name="MENTOR">
                    <option></option>
                    @foreach (var item in ViewBag.MENTORS)
                    {
                        <text>
                        <option value="@item.ID" @(MENTOR == item.ID ? "selected" : "")>@item.NAME.Trim()</option>
                        </text>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="to">Mentee:</label>
                <select class="form-control" id="mentee" name="EMP_ID">
                    <option></option>
                    @foreach (var item in ViewBag.MENTEES)
                    {
                        <text>
                        <option value="@item.ID" @(EMP_ID == item.ID ? "selected" : "")>@item.NAME.Trim()</option>
                        </text>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="to">Period:</label>
                <select class="form-control" id="selPeriod" name="COURSE_ID">
                    @if (Session["Role"] != null && Convert.ToInt32(Session["Role"]) == 3)
                    {
                        <option value="0"></option>
                    }
                    @foreach (var item in ViewBag.COURSE)
                    {
                        <text>
                        <option value="@item.ID" @((ViewBag.SELECT_COURSE != null && Convert.ToInt32(ViewBag.SELECT_COURSE) == item.ID) ? "selected" : "")>@item.NAME.Trim()</option>
                        </text>
                    }
                </select>
            </div>
            <button type="submit" id="btnSearch" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span>Search</button>
            <button id="btnExport" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-export"></span>Export</button>
        </form>
    </div>

    <div class="col-sm-4" style="max-height: 30px;">
        <div class="alert alert-info" style="display: none" id="noti">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong id="message"></strong>
        </div>
    </div>

</div>
<div class="table-responsive">
    <table id="tbMainDefault" class="table table-bordered">
        <thead>
            <tr class="tbheader">
                <th rowspan="2" style="vertical-align: middle;">Em ID</th>
                <th rowspan="2" style="vertical-align: middle;">Picture</th>
                <th rowspan="2" style="white-space: nowrap; vertical-align: middle;">Full Name</th>
                <th rowspan="2" style="vertical-align: middle;">Workgroup</th>
                <th rowspan="2" style="vertical-align: middle;">Period</th>
                <th colspan="5" style="vertical-align: middle; text-align: center;">OJT Plan</th>
                <th rowspan="2" style="vertical-align: middle;">Approval Status</th>
                <th colspan="4" style="vertical-align: middle; text-align: center;">Training Record</th>
                <th rowspan="2" style="vertical-align: middle;">Comment By Manager</th>
                <th rowspan="2" style="vertical-align: middle;">Comment By HR</th>
                <th colspan="3" style="vertical-align: middle; text-align: center;">Evaluation Result</th>
            </tr>
            <tr>
                <th style="vertical-align: middle;">Current Status</th>
                <th style="vertical-align: middle;">Course Content</th>
                <th style="vertical-align: middle;">Level</th>
                <th style="vertical-align: middle;">Start Date</th>
                <th style="vertical-align: middle;">End Date</th>
                <th style="vertical-align: middle;">Learning Outcomes</th>
                <th style="vertical-align: middle;">Activities Record</th>
                <th style="vertical-align: middle;">Start Date</th>
                <th style="vertical-align: middle;">End Date</th>
                <th style="vertical-align: middle;">Testing Time</th>
                <th style="vertical-align: middle;">Score</th>
                <th style="vertical-align: middle;">Level</th>
            </tr>

        </thead>
        <tbody>
            @for (int i = 0; i < ViewBag.HIS.Count; i++)
            {
                var step = i;
                int count = ViewBag.HIS[i].CNT_EMP;
                var cntCourse = ViewBag.HIS[i].CNT_COURSE;
                var his = ViewBag.HIS[i];
                <text>
                <tr>
                    <td rowspan="@his.CNT_EMP">@his.EMP_ID</td>
                    <td rowspan="@his.CNT_EMP">
                        <img src="@Url.Content("~/" + his.PICTURE.Trim())" class='img-rounded' height='100' width='100' alt='X' />
                    </td>
                    <td rowspan="@his.CNT_EMP">@his.EMP_NAME.Trim()</td>
                    <td rowspan="@his.CNT_EMP">@his.DEPARTMENT.Trim()</td>
                    <td rowspan="@his.CNT_COURSE">@his.PERIOD.Trim()</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" class="STATUS">@(his.STATUS == null ? "" : his.STATUS.Trim())</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" data-sid="@his.SUB_ID" class="SUB_ID">@(his.SUBJECT == null ? "" : his.SUBJECT)</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" class="SUB_LEVEL">@(his.SUB_LEVEL == null ? "" : his.SUB_LEVEL.Trim())</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" class="START_DT"><span>@(his.START_DT == null ? "" : his.START_DT.ToString("yyyy-MM-dd"))</span>
                        <input type="text" class="datepicker" value="@(his.START_DT == null ? now : his.START_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" class="END_DT"><span>@(his.END_DT == null ? "" : his.END_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his.END_DT == null ? now : his.END_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his.ID" class="APPROVE" data-dept="@his.DEPARTMENT.Trim()">@his.APPROVE.Trim()</td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID">
                        <a href="@Url.Action("Download", "Home", new { url = his.OUTCOME_RESULT == null ? download : his.OUTCOME_RESULT })">
                            <span class="glyphicon glyphicon-download-alt"></span>
                        </a>
                        &nbsp;
                        <a href="#" class="uploadfile">
                            <span class="glyphicon glyphicon-cloud-upload"></span>
                        </a>
                    </td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID"><a href="#" class="activity"><span class="badge">@his.ACTIVITY</span></a></td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID" class="REC_START_DT"><span>@(his.REC_START_DT == null ? "" : his.REC_START_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his.REC_START_DT == null ? now : his.REC_START_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID" class="REC_END_DT"><span>@(his.REC_END_DT == null ? "" : his.REC_END_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his.REC_END_DT == null ? now : his.REC_END_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his.HIS_ID" data-did="@his.ID" data-emp="@his.EMP_ID" data-dept="@his.DEPARTMENT.Trim()" class="MANAGER_CMT">@(his.MANAGER_CMT == null ? "" : his.MANAGER_CMT.Trim())</td>
                    <td data-id="@his.HIS_ID" data-did="@his.ID" class="HR_CMT">@(his.HR_CMT == null ? "" : his.HR_CMT.Trim())</td>
                    <td data-id="@his.ID" class="TEST_TIME" data-dept="@his.DEPARTMENT.Trim()"><span>@(his.TEST_TIME == null ? "" : his.TEST_TIME.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his.TEST_TIME == null ? now : his.TEST_TIME.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td rowspan="@his.CNT_EMP" class="SCORE" data-dept="@his.DEPARTMENT.Trim()" style="border-left-width:1px;" data-id="@his.HIS_ID">@his.SCORE</td>
                    <td rowspan="@his.CNT_EMP" class="RESULT_LEVEL" data-dept="@his.DEPARTMENT.Trim()" style="border-left-width:1px;" data-id="@his.HIS_ID">@(his.RESULT_LEVEL == null ? "" : his.RESULT_LEVEL)</td>
                </tr>
                </text>
              
                for (int j = 1; j < count; j++)
                {
                    step++;
                    var his1 = ViewBag.HIS[step];
                       
                <text>
                <tr>
                    @if (j % cntCourse == 0)
                    {
                        <td rowspan="@his1.CNT_COURSE">@his1.PERIOD.Trim()</td>
                    }
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" class="STATUS">@(his1.STATUS == null ? "" : his1.STATUS.Trim())</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" data-sid="@his1.SUB_ID" class="SUB_ID">@(his1.SUBJECT == null ? "" : his1.SUBJECT)</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" class="SUB_LEVEL">@(his1.SUB_LEVEL == null ? "" : his1.SUB_LEVEL.Trim())</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" class="START_DT"><span>@(his1.START_DT == null ? "" : his1.START_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his1.START_DT == null ? now : his1.START_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" class="END_DT"><span>@(his1.END_DT == null ? "" : his1.END_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his1.END_DT == null ? now : his1.END_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his1.ID" class="APPROVE" data-dept="@his1.DEPARTMENT.Trim()">@his1.APPROVE.Trim()</td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID">
                        <a href="@Url.Action("Download", "Home", new { url = his1.OUTCOME_RESULT == null ? download : his1.OUTCOME_RESULT })">
                            <span class="glyphicon glyphicon-download-alt"></span>
                        </a>
                        &nbsp;
                        <a href="#" class="uploadfile">
                            <span class="glyphicon glyphicon-cloud-upload"></span>
                        </a>
                    </td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID"><a href="#" class="activity"><span class="badge">@his1.ACTIVITY</span></a></td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID" class="REC_START_DT"><span>@(his1.REC_START_DT == null ? "" : his1.REC_START_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his1.REC_START_DT == null ? now : his1.REC_START_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID" class="REC_END_DT"><span>@(his1.REC_END_DT == null ? "" : his1.REC_END_DT.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his1.REC_END_DT == null ? now : his1.REC_END_DT.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                    <td data-id="@his1.HIS_ID" data-did="@his1.ID" data-dept="@his1.DEPARTMENT.Trim()" class="MANAGER_CMT">@(his1.MANAGER_CMT == null ? "" : his1.MANAGER_CMT.Trim())</td>
                    <td data-id="@his1.HIS_ID" data-did="@his1.ID" class="HR_CMT">@(his1.HR_CMT == null ? "" : his1.HR_CMT.Trim())</td>
                    <td data-id="@his1.ID" class="TEST_TIME" data-dept="@his1.DEPARTMENT.Trim()"><span>@(his1.TEST_TIME == null ? "" : his1.TEST_TIME.ToString("yyyy-MM-dd"))</span><input type="text" class="datepicker" value="@(his1.TEST_TIME == null ? now : his1.TEST_TIME.ToString("yyyy-MM-dd"))" style="display: none;" /></td>
                </tr>
                </text>
                
                }

                i += count - 1;
            }

        </tbody>
    </table>
</div>
<div id="mdCMT" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Comment</h4>
            </div>
            <div class="modal-body">
                <form id="frmCMT" role="form" data-id="" data-class="">
                    <div class="form-group">
                        <label class="sr-only" for="email">Comment:</label>
                        <textarea class="form-control" id="txtCmt" required="required"></textarea>
                    </div>
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-floppy-disk"></span>Save</button>
                </form>

            </div>
        </div>

    </div>
</div>
<div id="mdUpload" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><span class="glyphicon glyphicon-upload"></span>&nbsp;Upload File</h4>
            </div>
            <div class="modal-body">
                <form id="frmUpload" method="post" enctype="multipart/form-data" role="form" action="@Url.Action("Upload", "Home")">
                    <div class="form-group">
                        <label class="sr-only" for="file">File:</label>
                        <input type="file" name="OUTCOME_RESULT" accept="ppt|pptx" required="required" />
                        <input id="hdUpload" type="hidden" name="ID" value="" />
                    </div>
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-upload"></span>Upload</button>
                </form>

            </div>
        </div>

    </div>
</div>
<div id="mdImg" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><span class="glyphicon glyphicon-upload"></span>&nbsp;Activities Record</h4>
            </div>
            <div class="modal-body" id="img-content" data-url="@Url.Content("~/Upload/IMG/")">
            </div>
            <div class="modal-footer">
                <form id="frmUploadImg" class="form-inline" method="post" enctype="multipart/form-data" role="form" action="@Url.Action("UploadImg", "Home")">
                    <div class="form-group">
                        <label class="sr-only" for="file">Image:</label>
                        <input type="file" multiple name="img" accept="image/*" required="required" />
                        <input id="hdUploadImg" type="hidden" name="ID" value="" />
                    </div>
                    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-upload"></span>Upload</button>
                </form>
            </div>
        </div>

    </div>
</div>

@{
    ViewBag.Title = "MAIN";
    var MENTOR = Request.QueryString["MENTOR"];
    var EMP_ID = Request.QueryString["EMP_ID"];
}
@section Scripts
{
    <script src="@Url.Content("~/Scripts/home.js")"></script>
}
@Html.Hidden("hdUrl", Url.Action("Action", "Ajax"))
<input type="hidden" id="user" value="@Session["Username"]" data-role="@Session["Role"]" data-dept="@Session["Dept"]" />
<h4 class="page-header" style="margin: 10px;"><strong>Main</strong></h4>
<div class="row">
    <div class="col-sm-8">
        <form class="form-inline">
            <div class="form-group">
                <label for="from">Mentor:</label>
                <select class="form-control" id="mentor" name="MENTOR">
                    <option></option>
                    @foreach (var item in ViewBag.MENTORS)
                    {
                        <text>
                        <option value="@item.ID" @(MENTOR == item.ID ? "selected" : "")>@item.NAME.Trim()</option>
                        </text>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="to">Mentee:</label>
                <select class="form-control" id="mentee" name="EMP_ID">
                    <option></option>
                    @foreach (var item in ViewBag.MENTEES)
                    {
                        <text>
                        <option value="@item.ID" @(EMP_ID == item.ID ? "selected" : "")>@item.NAME.Trim()</option>
                        </text>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="to">Period:</label>
                <select class="form-control" id="selPeriod" name="COURSE_ID">
                    <option value="0"></option>
                    @foreach (var item in ViewBag.COURSE)
                    {
                        <text>
                        <option value="@item.ID" @((ViewBag.SELECT_COURSE != null && Convert.ToInt32(ViewBag.SELECT_COURSE) == item.ID) ? "selected" : "")>@item.NAME.Trim()</option>
                        </text>
                    }
                </select>
            </div>
            <button type="submit" id="btnSearch" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span>Search</button>

        </form>
    </div>

    <div class="col-sm-4">
        <button id="btnModify" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-pencil"></span>Modify</button>
        <button id="btnSave" class="btn btn-primary" type="button" data-action="0" data-emp=""><span class="glyphicon glyphicon-file"></span>Save</button>
        <button id="btnExport" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-export"></span>Export</button>
    </div>

</div>
<div class="table-responsive">
    <table id="tbMainDefault" class="table table-bordered">
        <thead>
            <tr class="tbheader">
                <th rowspan="2" style="vertical-align: middle;">Em ID</th>
                <th rowspan="2" style="vertical-align: middle;">Picture</th>
                <th rowspan="2" style="white-space: nowrap; vertical-align: middle;">Full Name</th>
                <th rowspan="2" style="vertical-align: middle;">Workgroup</th>
                <th rowspan="2" style="vertical-align: middle;">Period</th>
                <th colspan="5" style="vertical-align: middle;">OJT Plan</th>
                <th rowspan="2" style="vertical-align: middle;">Approval Status</th>
                <th colspan="4" style="vertical-align: middle;">Training Record</th>
                <th rowspan="2" style="vertical-align: middle;">Comment By Manager</th>
                <th rowspan="2" style="vertical-align: middle;">Comment By HR</th>
                <th colspan="3" style="vertical-align: middle;">Evaluation Result</th>
            </tr>
            <tr>
                <th style="vertical-align: middle;">Current Status</th>
                <th style="vertical-align: middle;">Course Content</th>
                <th style="vertical-align: middle;">Level</th>
                <th style="vertical-align: middle;">Start Date</th>
                <th style="vertical-align: middle;">End Date</th>
                <th style="vertical-align: middle;">Learning Outcomes</th>
                <th style="vertical-align: middle;">Activities Record</th>
                <th style="vertical-align: middle;">Start Date</th>
                <th style="vertical-align: middle;">End Date</th>
                <th style="vertical-align: middle;">Testing Time</th>
                <th style="vertical-align: middle;">Score</th>
                <th style="vertical-align: middle;">Level</th>
            </tr>

        </thead>
        <tbody>
            @for (int i = 0; i < ViewBag.HIS.Count; i++)
            {
                var step = i;
                int count = ViewBag.HIS[i].CNT_EMP;
                var cntCourse = ViewBag.HIS[i].CNT_COURSE;
                var his = ViewBag.HIS[i];
                <text>
                <tr>
                    <td rowspan="@his.CNT_EMP">@his.EMP_ID</td>
                    <td rowspan="@his.CNT_EMP">
                        <img src="@his.PICTURE.Trim()" class='img-rounded' height='100' width='100' alt='X' />
                    </td>
                    <td rowspan="@his.CNT_EMP">@his.EMP_NAME.Trim()</td>
                    <td rowspan="@his.CNT_EMP">@his.DEPARTMENT.Trim()</td>
                    <td rowspan="@his.CNT_COURSE">@his.PERIOD.Trim()</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" class="status">@(his.STATUS == null ? "" : his.STATUS.Trim())</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR" data-sid="@his.SUB_ID" class="subject">@his.SUB_ID</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR">@(his.SUB_LEVEL == null ? "" : his.SUB_LEVEL.Trim())</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR">@(his.START_DT == null ? "" : his.START_DT.ToString())</td>
                    <td data-id="@his.ID" data-mentor="@his.MENTOR">@(his.END_DT == null ? "" : his.END_DT.ToString())</td>
                    <td data-id="@his.ID">@his.APPROVE.Trim()</td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID"></td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID"></td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID">@(his.REC_START_DT == null ? "" : his.REC_START_DT.ToString())</td>
                    <td data-id="@his.ID" data-emp="@his.EMP_ID">@(his.REC_END_DT == null ? "" : his.REC_END_DT.Trim())</td>
                    <td data-id="@his.HIS_ID" data-emp="@his.EMP_ID">@(his.MANAGER_CMT == null ? "" : his.MANAGER_CMT.Trim())</td>
                    <td data-id="@his.HIS_ID">@(his.HR_CMT == null ? "" : his.HR_CMT.Trim())</td>
                    <td data-id="@his.ID">@(his.TEST_TIME == null ? "" : his.TEST_TIME.ToString())</td>
                    <td rowspan="@his.CNT_EMP" style="border-left-width:1px;" data-id="@his.HIS_ID">@his.SCORE</td>
                    <td rowspan="@his.CNT_EMP" style="border-left-width:1px;" data-id="@his.HIS_ID">@(his.RESULT_LEVEL == null ? "" : his.RESULT_LEVEL)</td>
                </tr>
                </text>
              
                for (int j = 1; j < count; j++)
                {
                    step++;
                    var his1 = ViewBag.HIS[step];
                       
                <text>
                <tr>
                    @if (j % cntCourse == 0)
                    {
                        <td rowspan="@his1.CNT_COURSE">@his1.PERIOD.Trim()</td>
                    }
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" class="status">@(his1.STATUS == null ? "" : his1.STATUS.Trim())</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR" data-sid="@his1.SUB_ID">@his1.SUB_ID</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR">@(his1.SUB_LEVEL == null ? "" : his1.SUB_LEVEL.Trim())</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR">@(his1.START_DT == null ? "" : his1.START_DT.ToString())</td>
                    <td data-id="@his1.ID" data-emp="@his1.MENTOR">@(his1.END_DT == null ? "" : his1.END_DT.ToString())</td>
                    <td data-id="@his1.ID">@his1.APPROVE.Trim()</td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID"></td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID"></td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID">@(his1.REC_START_DT == null ? "" : his1.REC_START_DT.ToString())</td>
                    <td data-id="@his1.ID" data-emp="@his1.EMP_ID">@(his1.REC_END_DT == null ? "" : his1.REC_END_DT.Trim())</td>
                    <td data-id="@his1.HIS_ID">@(his1.MANAGER_CMT == null ? "" : his1.MANAGER_CMT.Trim())</td>
                    <td data-id="@his1.HIS_ID">@(his1.HR_CMT == null ? "" : his1.HR_CMT.Trim())</td>
                    <td data-id="@his1.ID">@(his1.TEST_TIME == null ? "" : his1.TEST_TIME.ToString())</td>
                </tr>
                </text>
                
                }
               
                i += count - 1;
            }

        </tbody>
    </table>
</div>

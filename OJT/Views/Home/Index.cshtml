@{
    ViewBag.Title = "MAIN";
}
@section Scripts
{
    <script src="@Url.Content("~/Scripts/index.js")"></script>
}
@Html.Hidden("hdUrl", Url.Action("Action", "Home"))
<h4 class="page-header" style="margin: 10px;"><strong>Main</strong></h4>
<div class="row">
    <div class="col-sm-8">
        <div class="form-inline">
            <div class="form-group">
                <label for="from">Mentor:</label>
                <input id="mentor" type="text" class="form-control">
            </div>
            <div class="form-group">
                <label for="to">Mentee:</label>
                <input id="mentee" type="text" class="form-control">
            </div>
            <div class="form-group">
                <label for="to">Period:</label>
                <select class="form-control" id="selPeriod">
                    @foreach (var item in ViewBag.COURSE)
                    {
                        <option value="@item.ID">@item.NAME.Trim()</option>
                    }
                    <option></option>
                </select>
            </div>
            <button type="button" id="btnSearch" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span>Search</button>

        </div>
    </div>

    <div class="col-sm-4">
        <button id="btnModify" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-pencil"></span>Modify</button>
        <button id="btnSave" class="btn btn-primary" type="button" data-action="0" data-emp=""><span class="glyphicon glyphicon-file"></span>Save</button>
        <button id="btnExport" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-export"></span>Export</button>
    </div>

</div>
<div class="table-responsive">
    <table id="tbMainDefault" class="table table-bordered">
        <thead>
            <tr class="tbheader">
                <th rowspan="2" style="vertical-align: middle;">Em ID</th>
                <th rowspan="2" style="vertical-align: middle;">Picture</th>
                <th rowspan="2" style="white-space: nowrap; vertical-align: middle;">Full Name</th>
                <th rowspan="2" style="vertical-align: middle;">Workgroup</th>
                <th rowspan="2" style="vertical-align: middle;">Period</th>
                <th colspan="5" style="vertical-align: middle;">OJT Plan</th>
                <th rowspan="2" style="vertical-align: middle;">Approval Status</th>
                <th colspan="4" style="vertical-align: middle;">Training Record</th>
                <th rowspan="2" style="vertical-align: middle;">Comment By Manager</th>
                <th rowspan="2" style="vertical-align: middle;">Comment By HR</th>
                <th colspan="3" style="vertical-align: middle;">Evaluation Result</th>
            </tr>
            <tr>
                <th style="vertical-align: middle;">Current Status</th>
                <th style="vertical-align: middle;">Course Content</th>
                <th style="vertical-align: middle;">Level</th>
                <th style="vertical-align: middle;">Start Date</th>
                <th style="vertical-align: middle;">End Date</th>
                <th style="vertical-align: middle;">Learning Outcomes</th>
                <th style="vertical-align: middle;">Activities Record</th>
                <th style="vertical-align: middle;">Start Date</th>
                <th style="vertical-align: middle;">End Date</th>
                <th style="vertical-align: middle;">Testing Time</th>
                <th style="vertical-align: middle;">Score</th>
                <th style="vertical-align: middle;">Level</th>
            </tr>

        </thead>
        <tbody>
            @for (int i = 0; i < ViewBag.HIS.Count; i++)
            {
                int count = ViewBag.HIS[i].CNT_EMP;
                var cntCourse = ViewBag.HIS[i].CNT_COURSE;
                var his = ViewBag.HIS[i];
                <text>
                <tr>
                    <td rowspan="@his.CNT_EMP">@his.EMP_ID</td>
                    <td rowspan="@his.CNT_EMP">
                        <img src="@his.PICTURE.Trim()" class='img-rounded' height='100' width='100' alt='X' />
                    </td>
                    <td rowspan="@his.CNT_EMP">@his.EMP_NAME.Trim()</td>
                    <td rowspan="@his.CNT_EMP">@his.DEPARTMENT.Trim()</td>
                    <td rowspan="@his.CNT_COURSE">@his.PERIOD.Trim()</td>
                    <td>@(his.STATUS == null ? "" : his.STATUS.Trim())</td>
                    <td>@his.SUB_ID</td>
                    <td>@(his.SUB_LEVEL == null ? "" : his.SUB_LEVEL.Trim())</td>
                    <td>@(his.START_DT == null ? "" : his.START_DT.ToString())</td>
                    <td>@(his.END_DT == null ? "" : his.END_DT.ToString())</td>
                    <td>@his.APPROVE.Trim()</td>
                    <td></td>
                    <td></td>
                    <td>@(his.REC_START_DT == null ? "" : his.REC_START_DT.ToString())</td>
                    <td>@(his.REC_END_DT == null ? "" : his.REC_END_DT.Trim())</td>
                    <td>@(his.MANAGER_CMT == null ? "" : his.MANAGER_CMT.Trim())</td>
                    <td>@(his.HR_CMT == null ? "" : his.HR_CMT.Trim())</td>
                    <td>@(his.TEST_TIME == null ? "" : his.TEST_TIME.ToString())</td>
                    <td rowspan="@his.CNT_EMP" style="border-left-width:1px;">@his.SCORE</td>
                    <td rowspan="@his.CNT_EMP" style="border-left-width:1px;">@(his.RESULT_LEVEL == null ? "" : his.RESULT_LEVEL)</td>
                </tr>
                </text>
             
                for (int j = 1; j < count; j++)
                {
                    var his1 = ViewBag.HIS[j];
                <text>
                <tr>
                    @if (j % cntCourse == 0)
                    {
                        <td rowspan="@his1.CNT_COURSE">@his1.PERIOD.Trim()</td>
                    }
                    <td>@(his1.STATUS == null ? "" : his1.STATUS.Trim())</td>
                    <td>@his1.SUB_ID</td>
                    <td>@(his1.SUB_LEVEL == null ? "" : his1.SUB_LEVEL.Trim())</td>
                    <td>@(his1.START_DT == null ? "" : his1.START_DT.ToString())</td>
                    <td>@(his1.END_DT == null ? "" : his1.END_DT.ToString())</td>
                    <td>@his1.APPROVE.Trim()</td>
                    <td></td>
                    <td></td>
                    <td>@(his1.REC_START_DT == null ? "" : his1.REC_START_DT.ToString())</td>
                    <td>@(his1.REC_END_DT == null ? "" : his1.REC_END_DT.Trim())</td>
                    <td>@(his1.MANAGER_CMT == null ? "" : his1.MANAGER_CMT.Trim())</td>
                    <td>@(his1.HR_CMT == null ? "" : his1.HR_CMT.Trim())</td>
                    <td>@(his1.TEST_TIME == null ? "" : his1.TEST_TIME.ToString())</td>
                </tr>
                </text>
                }
                i += count - 1;
            }

        </tbody>
    </table>
</div>

